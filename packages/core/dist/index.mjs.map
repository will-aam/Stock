{"version":3,"sources":["../src/domain/product.ts","../src/domain/auth.ts","../src/schemas/product.schema.ts","../src/utils/formatters.ts"],"sourcesContent":["export enum ProductUnit {\r\n  UN = \"UN\",\r\n  KG = \"KG\",\r\n  LT = \"LT\",\r\n  CX = \"CX\",\r\n  FD = \"FD\",\r\n  M = \"M\",\r\n  M2 = \"M2\",\r\n}\r\n\r\nexport interface Product {\r\n  id: string;\r\n  name: string;\r\n  gtin: string;\r\n  ncm: string;\r\n  unit: ProductUnit;\r\n  description?: string;\r\n  categoryId?: string;\r\n}\r\n","// String alias para deixar explícito\r\nexport type PermissionString = string; // Ex: 'products:read'\r\n\r\nexport interface Role {\r\n  id: string;\r\n  name: string;\r\n  permissions: PermissionString[];\r\n  inheritsFrom?: string[]; // IDs de roles que este herda\r\n}\r\n\r\nexport interface UserSession {\r\n  id: string;\r\n  name: string;\r\n  roles: string[];\r\n  permissions: PermissionString[]; // Flattened permissions\r\n}\r\n\r\n// Helpers Puros\r\nexport const hasPermission = (\r\n  userPermissions: string[],\r\n  required: string,\r\n): boolean => {\r\n  return userPermissions.includes(required);\r\n};\r\n\r\nexport const hasAnyPermission = (\r\n  userPermissions: string[],\r\n  required: string[],\r\n): boolean => {\r\n  return required.some((p) => userPermissions.includes(p));\r\n};\r\n\r\nexport const hasAllPermissions = (\r\n  userPermissions: string[],\r\n  required: string[],\r\n): boolean => {\r\n  return required.every((p) => userPermissions.includes(p));\r\n};\r\n\r\n// Constantes de Permissão (Para evitar magic strings no front)\r\nexport const PERMISSIONS = {\r\n  PRODUCTS: {\r\n    READ: \"products:read\",\r\n    WRITE: \"products:write\",\r\n    DELETE: \"products:delete\",\r\n  },\r\n  COMPANIES: {\r\n    READ: \"companies:read\",\r\n    manage: \"companies:manage\",\r\n  },\r\n  // ... expandir conforme necessário\r\n} as const;\r\n","import { z } from \"zod\";\r\nimport { ProductUnit } from \"../domain/product\";\r\nimport { normalizeNumeric } from \"../utils/formatters\";\r\n\r\nexport const ProductSchema = z.object({\r\n  name: z.string().min(3, \"Nome muito curto\").max(120, \"Nome muito longo\"),\r\n\r\n  gtin: z\r\n    .string()\r\n    .transform(normalizeNumeric) // Normaliza antes de validar\r\n    .refine((val) => [8, 12, 13, 14].includes(val.length), {\r\n      message: \"GTIN inválido (esperado 8, 12, 13 ou 14 dígitos)\",\r\n    }),\r\n\r\n  ncm: z\r\n    .string()\r\n    .transform(normalizeNumeric)\r\n    .refine((val) => val.length === 8, {\r\n      message: \"NCM deve ter exatamente 8 dígitos\",\r\n    }),\r\n\r\n  unit: z.nativeEnum(ProductUnit, {\r\n    errorMap: () => ({ message: \"Unidade inválida\" }),\r\n  }),\r\n\r\n  price_cost: z.number().min(0).optional(),\r\n  price_sell: z.number().min(0).optional(),\r\n});\r\n\r\nexport type ProductFormValues = z.infer<typeof ProductSchema>;\r\n// Cria um schema só com os campos desta tela\r\nconst Step1Schema = ProductSchema.pick({\r\n  name: true,\r\n  gtin: true,\r\n  ncm: true,\r\n  unit: true,\r\n});\r\n\r\ntype Step1Values = z.infer<typeof Step1Schema>;\r\n","// Remove caracteres não numéricos (Normalização canônica)\r\nexport const normalizeNumeric = (value: string): string => {\r\n  return value.replace(/\\D/g, \"\");\r\n};\r\n\r\n// Formatação para exibição (Display only)\r\nexport const formatGTIN = (value: string): string => {\r\n  const numeric = normalizeNumeric(value);\r\n  // Simples retorno visual ou lógica específica se quiser separar EAN-13\r\n  return numeric;\r\n};\r\n\r\nexport const formatNCM = (value: string): string => {\r\n  const v = normalizeNumeric(value);\r\n  return v.replace(/^(\\d{4})(\\d{2})(\\d{2}).*/, \"$1.$2.$3\");\r\n};\r\n\r\nexport const formatCNPJ = (value: string): string => {\r\n  const v = normalizeNumeric(value);\r\n  return v.replace(/^(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2}).*/, \"$1.$2.$3/$4-$5\");\r\n};\r\n"],"mappings":";AAAO,IAAK,cAAL,kBAAKA,iBAAL;AACL,EAAAA,aAAA,QAAK;AACL,EAAAA,aAAA,QAAK;AACL,EAAAA,aAAA,QAAK;AACL,EAAAA,aAAA,QAAK;AACL,EAAAA,aAAA,QAAK;AACL,EAAAA,aAAA,OAAI;AACJ,EAAAA,aAAA,QAAK;AAPK,SAAAA;AAAA,GAAA;;;ACkBL,IAAM,gBAAgB,CAC3B,iBACA,aACY;AACZ,SAAO,gBAAgB,SAAS,QAAQ;AAC1C;AAEO,IAAM,mBAAmB,CAC9B,iBACA,aACY;AACZ,SAAO,SAAS,KAAK,CAAC,MAAM,gBAAgB,SAAS,CAAC,CAAC;AACzD;AAEO,IAAM,oBAAoB,CAC/B,iBACA,aACY;AACZ,SAAO,SAAS,MAAM,CAAC,MAAM,gBAAgB,SAAS,CAAC,CAAC;AAC1D;AAGO,IAAM,cAAc;AAAA,EACzB,UAAU;AAAA,IACR,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA,WAAW;AAAA,IACT,MAAM;AAAA,IACN,QAAQ;AAAA,EACV;AAAA;AAEF;;;ACnDA,SAAS,SAAS;;;ACCX,IAAM,mBAAmB,CAAC,UAA0B;AACzD,SAAO,MAAM,QAAQ,OAAO,EAAE;AAChC;AAGO,IAAM,aAAa,CAAC,UAA0B;AACnD,QAAM,UAAU,iBAAiB,KAAK;AAEtC,SAAO;AACT;AAEO,IAAM,YAAY,CAAC,UAA0B;AAClD,QAAM,IAAI,iBAAiB,KAAK;AAChC,SAAO,EAAE,QAAQ,4BAA4B,UAAU;AACzD;AAEO,IAAM,aAAa,CAAC,UAA0B;AACnD,QAAM,IAAI,iBAAiB,KAAK;AAChC,SAAO,EAAE,QAAQ,0CAA0C,gBAAgB;AAC7E;;;ADhBO,IAAM,gBAAgB,EAAE,OAAO;AAAA,EACpC,MAAM,EAAE,OAAO,EAAE,IAAI,GAAG,kBAAkB,EAAE,IAAI,KAAK,kBAAkB;AAAA,EAEvE,MAAM,EACH,OAAO,EACP,UAAU,gBAAgB,EAC1B,OAAO,CAAC,QAAQ,CAAC,GAAG,IAAI,IAAI,EAAE,EAAE,SAAS,IAAI,MAAM,GAAG;AAAA,IACrD,SAAS;AAAA,EACX,CAAC;AAAA,EAEH,KAAK,EACF,OAAO,EACP,UAAU,gBAAgB,EAC1B,OAAO,CAAC,QAAQ,IAAI,WAAW,GAAG;AAAA,IACjC,SAAS;AAAA,EACX,CAAC;AAAA,EAEH,MAAM,EAAE,WAAW,aAAa;AAAA,IAC9B,UAAU,OAAO,EAAE,SAAS,sBAAmB;AAAA,EACjD,CAAC;AAAA,EAED,YAAY,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,SAAS;AAAA,EACvC,YAAY,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,SAAS;AACzC,CAAC;AAID,IAAM,cAAc,cAAc,KAAK;AAAA,EACrC,MAAM;AAAA,EACN,MAAM;AAAA,EACN,KAAK;AAAA,EACL,MAAM;AACR,CAAC;","names":["ProductUnit"]}